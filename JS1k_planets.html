<!DOCTYPE html>
<!-- saved from url=(0045)http://js1k.com/2014-dragons/shim-normal.html -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<title>JS1k, [COMPO] demo submission [ID]</title>
		<meta charset="utf-8">
    <style>
      html, body { margin: 0; padding: 0; border: 0; }
      #c { display: block; } /* kill scrollbars from hell */
    </style>
	</head>
	<body>
		<canvas id="c" width="1302" height="739" style="width: 1302px; height: 739px;"></canvas>
		<script>
			var a = document.getElementsByTagName('canvas')[0];
			var b = document.body;
			  var d = function(e){ return function(){ e.parentNode.removeChild(e); }; }(a);
			  // unprefix some popular vendor prefixed things (but stick to their original name)
			  var AudioContext =
			    window.AudioContext ||
			    window.webkitAudioContext;
			  var requestAnimationFrame =
			    window.requestAnimationFrame ||
			    window.mozRequestAnimationFrame ||
			    window.webkitRequestAnimationFrame ||
			    window.msRequestAnimationFrame ||
			    function(f){ setTimeout(f, 1000/30); };
			  // stretch canvas to screen size (once, wont onresize!)
			  a.style.width = (a.width = innerWidth) + 'px';
			  a.style.height = (a.height = innerHeight) + 'px';
			
			  var c = a.getContext('2d');
		</script>
		<script>

			// start of submission //
			var sx = a.width/2,
				sy = a.height/2,
				m = Math;
				
			
			function dp(x, y, r, cl, cl2) {
			var grd = c.createRadialGradient(x,y,0,x,y,r),
				cl2 = cl2 ? cl2 : 'black';
				grd.addColorStop(0, cl);
				grd.addColorStop(1, cl2);
				c.beginPath();
			    c.arc(x, y, r, 0, 2 * m.PI, false);
			    pen(grd);
			}
			
			function pen(fil) {
				c.fillStyle = fil;
				c.fill();
			}

			function p(x, y, vx, vy, ax, ay, r, clr) {
				return {
					x : x,
					y: y,
					vx : vx,
					vy: vy,
					ax : ax,
					ay : ay,
					r : r,
					clr : clr
				}
			}
			
			var ps = [new p(sx, sy, 0, 0, 0, 0, 20, 'yellow'),
				new p(sx + 100, sy - 100, 6, 6, 1.5, 1.5, 10, 'red'),
				new p(sx + 50, sy - 50, 5, 5, 1.5, 1.5, 10, 'blue'),
				new p(sx/3, sy/3, -5, 5, 0.5, 0.5, 25, 'yellow'),
				new p(sx + 200, sy - 200, -10, -10, 1.2, 1.2, 20, 'purple')],
				ss = [],
				pts = [];
				
			function rnd(t) {
				return (m.random() * t);
			}
			
			
			for (i=0; i < 100; i++){
				ss.push({x: rnd(2*sx), y: rnd(2*sy), s: rnd(2)});
				pts.push(new ple());
			}
			
			setInterval(function() {
				c.clearRect(0,0,sx*2, sy*2);
				c.rect(0,0,sx*2,sy*2);
				pen('black');
				
				for (var i = 0; i < 5; i++) {
					
					var	aX = (ps[i].x > sx) ? -ps[i].ax : ps[i].ax;
					
					var aY = (ps[i].y > sy) ? -ps[i].ay : ps[i].ay;
					
					ps[i].x += ps[i].vx + (aX / 2);
					ps[i].y += ps[i].vy + (aY / 2);
					
					dp(ps[i].x, ps[i].y, ps[i].r + ps[i].r * (ps[i].y - sy)/sy, ps[i].clr);
					ps[i].vx += aX /2;
					ps[i].vy += aY /2;
				}
				for (var j = 0; j < 100; j++) {
					dp(ss[j].x, ss[j].y, rnd(2), 'white');
				
					var p = pts[j];
					c.globalCompositeOperation = "lighter";
					dp(p.x, p.y, p.r, p.cll, p.cll);
	
					p.r--;
					p.x += p.vx;
					p.y += p.vy;
			
					if ( p.r < 0)	{
						pts[j] = new ple();
					}
				}
			}, 30)
			
			function ple()
			{
				var d = new p(sx, sy, -2.5+rnd(5), -3+rnd(4), 0, 0, 10+rnd(10));
				d.cll = "rgba(" + R(rnd(255)) +"," + R(rnd(150)) + "," + R(rnd(30)) + ", 0.1)";
				return d;
			}
		
			function R(d) {
				return m.round(d);
			}
					// end of submission //
		</script>
	

</body></html>