<!DOCTYPE html>
<!-- saved from url=(0045)http://js1k.com/2014-dragons/shim-normal.html -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<title>JS1k, [COMPO] demo submission [ID]</title>
		<meta charset="utf-8">
    <style>
      html, body { margin: 0; padding: 0; border: 0; }
      #c { display: block; } /* kill scrollbars from hell */
    </style>
	</head>
	<!--earth = {
					x: sx + 100,
					y: sy - 100,
					vx: 5,
					vy: 5,
					size: 5
				},
				sun = {
					x: sx,
					y: sy,
					vx: 0,
					vy: 0,
					size: 20
				},
				moon = {
					x: earth.x + 20,
					y: earth.y + 20,
					vx: 50,
					vy: 50,
					size: 2
				}
				mars = {
					x: sx + 150,
					y: sy - 150,
					vx: 8,
					vy: 8,
					size: 4
				}
				for (i=1; i < 500; i++){
				var asteroid = {
				x: sx + i * 5,
				y: sy - i *5,
				vx: 10,
				vy: 10,
				size: 2
				};
				
				orbit(asteroid, sun, true, 2, 2, 'white');
			}
				-->
	<body>
		<canvas id="c" width="1302" height="739" style="width: 1302px; height: 739px;"></canvas>
		<script>
			var a = document.getElementsByTagName('canvas')[0];
			var b = document.body;
			  var d = function(e){ return function(){ e.parentNode.removeChild(e); }; }(a);
			  // unprefix some popular vendor prefixed things (but stick to their original name)
			  var AudioContext =
			    window.AudioContext ||
			    window.webkitAudioContext;
			  var requestAnimationFrame =
			    window.requestAnimationFrame ||
			    window.mozRequestAnimationFrame ||
			    window.webkitRequestAnimationFrame ||
			    window.msRequestAnimationFrame ||
			    function(f){ setTimeout(f, 1000/30); };
			  // stretch canvas to screen size (once, wont onresize!)
			  a.style.width = (a.width = innerWidth) + 'px';
			  a.style.height = (a.height = innerHeight) + 'px';
			
			  var c = a.getContext('2d');
		</script>
		<script>

			// start of submission //
			var sx = a.width/2,
				sy = a.height/2,
				planets = [];
				
			
			function drawPlanet(x, y, r, col) {
				c.beginPath();
			    c.arc(x, y, r, 0, 2 * Math.PI, false);
			  	c.fillStyle = col;
			    c.fill();
			}
			
			
			
			var p = function(x, y, vx, vy, ax, ay, size, centre, colour, cent) {
				this.x = x;
				this.y = y;
				this.vx = vx;
				this.vy = vy;
				this.ax = ax;
				this.ay = ay;
				this.size = size;
				this.centre = centre;
				this.colour = colour;
				this.movCent = cent;
			}
			
			var sun = new p(sx, sy, 0, 0, 0, 0, 20, null, 'yellow', false);
			var mars = new p(sx + 100, sy - 100, 6, 6, 1.5, 1.5, 8, sun, 'red', false);
			var earth = new p(sx + 50, sy - 50, 5, 5, 1.5, 1.5, 8, sun, 'blue', false);
			
			var moon = new p(earth.x - 20, earth.y + 20, 10, 10, 3, 3, 2, earth, 'gray', true);
			var jupiter = new p(sx + 200, sy - 200, -10, -10, 1, 1, 15, sun, 'purple', false);
			planets = [ mars, earth, moon, jupiter];
			
			setInterval(function() {
				
				c.clearRect(0,0,sx*2, sy*2);
				c.rect(0,0,sx*2,sy*2);
				c.fillStyle="black";
				c.fill();
				stars();
				//drawPlanet(sx, sy, 10, 'yellow');
			}, 30);

			function random(total) {
				return (Math.random() * total);
			}
			function stars() {
			for (i=1; i < 100; i++){
				//var asteroid = {
				//x: sx + i * random(2),
				//y: sy - 2 - i * 2,
				//vx: 10 + random(10),
				//vy: 10 + random(20),
				//ax: 1,
				//ay: 0.5,
				//size: 1,
				//centre: sun,
				//colour: 'white',
				//movCent: false,
				//};
				drawPlanet(random(2*sx), random(2*sy), random(2), 'white');
				
				//planets.push(asteroid);
			}
			}
			
			orbit();
			function orbit() {
				
					
				setInterval(function() {
					
					for (var i = 0; i < planets.length; i++) {
						
						var	aX = (planets[i].x > planets[i].centre.x) ? -planets[i].ax : planets[i].ax;
						
						var aY = (planets[i].y > planets[i].centre.y) ? -planets[i].ay : planets[i].ay;
						
						//drawPlanet(planet.x, planet.y, 1 + planet.size + planet.size * (planet.y - sy)/sy, 'black');
						if (planets[i].movCent){ // null if fixed e.g. sun
							planets[i].x = planets[i].centre.x;
							planets[i].y = planets[i].centre.y;
						}
						planets[i].x += planets[i].vx + (aX / 2);
						planets[i].y += planets[i].vy + (aY / 2);
						
						drawPlanet(planets[i].x, planets[i].y, planets[i].size + planets[i].size * (planets[i].y - sy)/sy, planets[i].colour);
						planets[i].vx += aX /2;
						planets[i].vy += aY /2;
					}
					draw();
				}, 30)
			}
			
			
	var particles = [];

	
	//Lets create some particles now
	var particle_count = 50;
	for(var i = 0; i < particle_count; i++)
	{
		particles.push(new particle());
	}
	
	function particle()
	{
		this.speed = {x: -2.5+random(5), y: -3+random(4)};
		this.location = {x: sx, y: sy};
		this.radius = 10+random(10);
		this.life = 20+random(10);
		this.remaining_life = this.life;
		this.r = m(random(255));
		this.g = m(random(100));
		this.b = m(random(25));
	}
	
	function draw()
	{
		c.globalCompositeOperation = "lighter";
		
		for(var i = 0; i < particles.length; i++)
		{
			var p = particles[i];
			c.beginPath();
			p.opacity = m(p.remaining_life/p.life*100)/100
			var gradient = c.createRadialGradient(p.location.x, p.location.y, 0, p.location.x, p.location.y, p.radius);
			gradient.addColorStop(0, "rgba("+p.r+", "+p.g+", "+p.b+", "+p.opacity+")");
			gradient.addColorStop(0.5, "rgba("+p.r+", "+p.g+", "+p.b+", "+p.opacity+")");
			gradient.addColorStop(1, "rgba("+p.r+", "+p.g+", "+p.b+", 0)");
			c.fillStyle = gradient;
			c.arc(p.location.x, p.location.y, p.radius, Math.PI*2, false);
			c.fill();
			
			//lets move the particles
			p.remaining_life--;
			p.radius--;
			p.location.x += p.speed.x;
			p.location.y += p.speed.y;
			
			if (p.remaining_life<0 || p.radius < 0)	{
				particles[i] = new particle();
			}
		}
	}
	function m(d) {
		return Math.round(d);
	}
			// end of submission //
		</script>
	

</body></html>